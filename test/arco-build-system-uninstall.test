#!/usr/bin/python
# -*- mode:python; coding:utf-8; tab-width:4 -*-

import os

ENV = {'ARCO_MK':os.path.abspath('make'),
       'DESTDIR':'/tmp'}

Command('make -C samples/make distclean', env=ENV)
Command('make -C samples/make install', env=ENV)

uninstall = Test('make -C samples/make uninstall', env=ENV)

for lib in ['liba','libb','libd']:
    for suffix in ['.so', '.so.23', '.so.2.3', '.a']:
        uninstall.post += FileExists(os.path.join('samples/make/lib/',lib+suffix))
        uninstall.post += Not(FileExists(os.path.join(ENV['DESTDIR'],'usr/lib/',lib+suffix)))

    lib_path = os.path.join('samples/make/include/',lib)

    uninstall.post += DirExists(lib_path)
    uninstall.post += FileExists(os.path.join(ENV['DESTDIR'],'usr/include/',lib))

    uninstall.post += FileExists(os.path.join(lib_path, lib[3:]+'.h'))
    uninstall.post += Not(FileExists(os.path.join(ENV['DESTDIR'],'usr/include/%s' % lib,
                                                  lib[3:]+'.h')))

uninstall.post += FileExists('samples/make/bin/main')
uninstall.post += Not(FileExists(ENV['DESTDIR']+'/usr/bin/main'))

Command('make -C samples/make distclean', env=ENV)
